# 批量选择功能说明

## ✅ 已完成的功能

### 1. 批量选择UI ✅

**位置**: 题库管理 → 筛选与操作区域

**功能组件**:
- ✅ **全选复选框**: 一键选择/取消选择当前页所有题目
- ✅ **批量删除按钮**: 显示已选题目数量，禁用状态（未选时）
- ✅ **题目复选框**: 每个题目卡片左上角有复选框

### 2. 状态管理 ✅

```typescript
// 批量选择相关
const selectedQuestions = ref<string[]>([])  // 已选题目ID列表
const selectAll = ref(false)                 // 全选状态
```

### 3. 核心函数 ✅

#### toggleSelectAll() - 全选/取消全选
```typescript
const toggleSelectAll = () => {
  if (selectAll.value) {
    // 全选当前页的所有题目
    selectedQuestions.value = pagedQuestions.value.map(q => q.qid)
  } else {
    // 取消全选
    selectedQuestions.value = []
  }
}
```

#### batchDelete() - 批量删除
```typescript
const batchDelete = async () => {
  if (selectedQuestions.value.length === 0) return
  
  // 1. 确认对话框
  await ElMessageBox.confirm(
    `确认删除选中的 ${selectedQuestions.value.length} 个题目？删除后将移到回收站。`,
    '批量删除',
    { type: 'warning' }
  )
  
  // 2. 调用删除API
  const resp = await fetch(`${MCQ_BASE_URL}/bank/delete`, {
    method: 'POST',
    headers: { 
      'Content-Type': 'application/json',
      'X-User-Name': store.state.user.username,
      'X-User-Role': userRole.value
    },
    body: JSON.stringify({ 
      ids: selectedQuestions.value,
      user: store.state.user.username,
      role: userRole.value
    })
  })
  
  // 3. 处理结果
  if (data?.ok) {
    ElMessage.success(`已删除 ${data.count} 个题目`)
    selectedQuestions.value = []  // 清空选择
    selectAll.value = false       // 取消全选
    loadQuestions()               // 刷新列表
  }
}
```

## 🎨 UI展示

### 筛选与操作区域

```
┌─────────────────────────────────────────────────────────────┐
│ 筛选与操作                                                    │
├─────────────────────────────────────────────────────────────┤
│ [状态▼] [刷新]  ☑全选 [批量删除 (3)] │ [批量通过] [批量驳回] │
└─────────────────────────────────────────────────────────────┘
```

### 题目卡片

```
┌─────────────────────────────────────────────────────────────┐
│ ☑ 1. 以下关于边防检查的说法正确的是？          [已通过]     │
│   A. 选项内容...                                             │
│   B. 选项内容...                                             │
│   [查看解析] [编辑] [通过] [驳回] [删除]                     │
└─────────────────────────────────────────────────────────────┘
```

## 🔧 使用流程

### 1. 选择题目

**方式一：单个选择**
- 点击题目卡片左上角的复选框
- 可以选择多个题目

**方式二：全选**
- 点击工具栏的"全选"复选框
- 自动选中当前页所有题目
- 再次点击取消全选

### 2. 批量删除

1. 选择要删除的题目（至少1个）
2. 点击"批量删除 (N)"按钮
3. 确认删除对话框
4. 题目移到回收站
5. 自动清空选择并刷新列表

### 3. 取消选择

- 点击"全选"复选框取消全选
- 或逐个取消题目的复选框

## 📋 功能特点

### 1. 智能状态管理
- ✅ 自动统计已选数量
- ✅ 未选时禁用批量删除按钮
- ✅ 删除后自动清空选择

### 2. 用户友好
- ✅ 实时显示已选数量："批量删除 (3)"
- ✅ 确认对话框防止误操作
- ✅ 操作成功后即时反馈

### 3. 权限控制
- ✅ 需要管理员或超级管理员权限
- ✅ 发送用户角色信息到后端验证

### 4. 软删除保护
- ✅ 批量删除后题目移到回收站
- ✅ 可以从回收站恢复
- ✅ 30天保护期

## 🔐 权限要求

批量删除功能需要以下权限：
- **管理员** (admin)
- **超级管理员** (super_admin)

普通用户无法看到或使用批量删除功能。

## 🎯 与其他功能的配合

### 与状态筛选配合
1. 先筛选特定状态的题目（如"草稿"）
2. 全选当前筛选结果
3. 批量删除

### 与分页配合
- 全选只选择**当前页**的题目
- 切换页面后需要重新选择
- 这样设计避免误删大量题目

### 与回收站配合
- 批量删除的题目进入回收站
- 可以在回收站批量恢复
- 或永久删除

## 💡 使用技巧

### 1. 快速清理草稿
```
1. 筛选状态 → 草稿
2. 点击"全选"
3. 批量删除
```

### 2. 选择性删除
```
1. 不使用全选
2. 逐个勾选要删除的题目
3. 批量删除
```

### 3. 分批处理
```
1. 设置每页显示数量（如20题）
2. 全选当前页
3. 批量删除
4. 切换到下一页继续
```

## ⚠️ 注意事项

1. **全选范围**: 只选择当前页的题目，不是所有题目
2. **权限检查**: 后端会验证用户权限，前端只是UI控制
3. **软删除**: 批量删除后题目进入回收站，不是永久删除
4. **确认操作**: 每次批量删除都需要确认，防止误操作
5. **自动清空**: 删除成功后自动清空选择状态

## 🧪 测试清单

- [ ] 单个选择题目
- [ ] 全选当前页所有题目
- [ ] 取消全选
- [ ] 批量删除（2-3个题目）
- [ ] 批量删除（全选后）
- [ ] 未选时批量删除按钮禁用
- [ ] 删除后自动清空选择
- [ ] 删除后题目进入回收站
- [ ] 权限不足时无法删除
- [ ] 切换页面后选择状态重置

## 📊 数据流程

```
用户勾选题目
  ↓
selectedQuestions 数组更新
  ↓
按钮显示已选数量
  ↓
点击批量删除
  ↓
确认对话框
  ↓
POST /bank/delete (带用户信息和角色)
  ↓
后端权限验证
  ↓
软删除题目（标记deleted=True）
  ↓
记录删除日志
  ↓
返回成功响应
  ↓
前端清空选择
  ↓
刷新题库列表
```

## 🎉 总结

批量选择功能已完全实现，包括：

✅ **UI组件**: 全选复选框、题目复选框、批量删除按钮  
✅ **状态管理**: selectedQuestions、selectAll  
✅ **核心函数**: toggleSelectAll、batchDelete  
✅ **权限控制**: 需要管理员权限  
✅ **用户体验**: 实时反馈、确认对话框、自动清空  
✅ **数据安全**: 软删除、回收站保护

现在你可以：
1. 勾选多个题目
2. 点击"全选"选择当前页所有题目
3. 点击"批量删除"一次性删除多个题目
4. 从回收站恢复误删的题目

**批量操作大大提高了题库管理效率！** 🚀
